<link rel="import" href="../bower_components/polymer/polymer.html" />
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html" />
<link rel="import" href="elements.html">

<dom-module id="main-page">
    <style></style>
    <template>

        <iron-ajax 
                   id="allWeather"
                   url="{{getAllWeatherUrl}}"
                   method="GET"
                   content-type="application/json"
                   loading ="{{loading}}"
                   last-response="{{cities}}"></iron-ajax>

        <paper-drawer-panel id="paperDrawerPanel">
            <!-- Left Panel -->
            <paper-scroll-header-panel drawer fixed>

                <paper-toolbar id="drawerToolbar">
                    <span class="menu-name"><iron-icon icon="icons:filter-list"></iron-icon>City Filter</span>
                </paper-toolbar>

                <div class="app-menu">
                    <div>
                        <checkbox-list data-list="{{cities}}"></checkbox-list>
                    </div>
                </div>
            </paper-scroll-header-panel>

            <!-- Main Panel -->
            <paper-scroll-header-panel main id="headerPanelMain" condenses keep-condensed-header>
                <!-- Main Toolbar -->
                <paper-toolbar id="mainToolbar" class="tall" style="background-color:#455A64">
                    <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>

                    <div class="middle middle-container">
                        <div class="app-name">Decision Inc. Weather Service</div>
                    </div>

                    <div class="bottom bottom-container">
                        <div class="bottom-title">Better Decisions, Faster</div>
                    </div>
                </paper-toolbar>

                <!-- Main Content -->
                <div>
                    <weather-card id="weatherCards"></weather-card>
                </div>

            </paper-scroll-header-panel>
        </paper-drawer-panel>
    </template>
    <script>


        Polymer({

            is: 'main-page',


            listeners: {
                'filter': '_applyFilter',
                'clearFilter': '_setClearFilter'
            },
            
            properties: {

                cities: {
                    type: Array, value: [
                        { name: "All", id: 0, check: true },
                        { name: "Johannesburg", id: 0, check: false },
                        { name: "Cape Town", id: 1, check: false },
                        { name: "Durban", id: 2, check: false },
                        { name: "Pretoria", id: 3, check: false },
                        { name: "Umhlanga", id: 4, check: false },
                        { name: "Upington", id: 5, check: false },
                        { name: "Witbank", id: 6, check: false },
                        { name: "Secunda", id: 7, check: false }
                    ]
                },

                isLoading: { type: Boolean, value: true },
                isClearFilter: { type: Boolean, value: false },

                getAllWeatherUrl: { type: String, value: "Weather/GetAllWeather" },
                filterListUrl: { type: String, value: "" }

                
            },

            ready: function () {
                this.$.allWeather.generateRequest();
            },

            _setClearFilter: function () {
                debugger;
                this.isClearFilter = true; 
                this._applyFilter();
            },

            _applyFilter: function (e) {
                debugger;
                var _th = this; 

                if (this.isClearFilter) {

                    _th.isLoading = true;
                    $.post(_th.getAllWeatherUrl, function (data) {

                        debugger;
                        _th.isLoading = false;
                    });
                }

                else {
                    var idsList = e.detail.List; 

                    _th.isLoading = true; 
                    $.post(_th.filterListUrl, { List: idsList }, function (data) {

                        debugger;
                        _th.isLoading = false; 
                    });
                }
                
            }
        });
    </script>
</dom-module>
